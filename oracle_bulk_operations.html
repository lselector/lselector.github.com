<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Description" content="Machine Learning, AI, Data Science, Python, Jupyter, Linux, Cloud, SQL">
   <meta name="GENERATOR" content="Mozilla/4.7 [en] (WinNT; U) [Netscape]">
   <meta name="Author" content="Lev Selector">
   <title>oracle bulk operations</title>
<!--

"Description" content="Machine Learning, AI, Data Science, Python, Jupyter, Linux, Cloud, SQL"

-->
<link REL="stylesheet" TYPE="text/css" HREF="style0.css" >
<style type="text/css">
<!--
.style1 {
	color: #CC0000;
	font-weight: bold;
}
-->
</style>
</head>
<body text="#000000" bgcolor="#FFFFFF">
<a NAME="top"></a>
<table BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH="100%" >
<tr>
<td ALIGN=LEFT WIDTH="1%"><spacer type=block width=1 height=1></td>

<td ALIGN=LEFT><b><font color="#CC0000">LevSelector.com</font></b><spacer type=block width=1 height=1></td>

<td ALIGN=RIGHT VALIGN=BOTTOM><spacer type=block width=1 height=1><b><font color="#CC0000">New
York</font></b></td>

<td ALIGN=LEFT WIDTH="1%"><spacer type=block width=1 height=1></td>
</tr>
</table>

<table BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH="100%" >
<tr>
<td><spacer type=block width=1 height=1></td>
</tr>

<tr>
<td BGCOLOR="#66CCFF"><spacer type=block width=1 height=1></td>
</tr>

<tr>
<td><spacer type=block width=1 height=1></td>
</tr>
</table>

<table BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH="100%" BGCOLOR="#C4ECFF" >
<tr>
<td ALIGN=LEFT WIDTH="1%"><spacer type=block width=1 height=1></td>

<td ALIGN=LEFT><spacer type=block width=1 height=1>
<b><a href="index.html">home</a>
> Oracle Bulk Operations</b></td>

<td ALIGN=RIGHT VALIGN=BOTTOM><spacer type=block width=1 height=1><b></b></td>

<td ALIGN=LEFT WIDTH="1%"><spacer type=block width=1 height=1></td>
</tr>
</table>

<table BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH="100%" >
<tr>
<td><spacer type=block width=1 height=1></td>
</tr>

<tr>
<td BGCOLOR="#51C7FF"><spacer type=block width=1 height=1></td>
</tr>

<tr>
<td><spacer type=block width=1 height=1></td>
</tr>
</table>

<p><b><font color="#CC0000">Oracle Bulk Operations</font></b>
<p><br>
  <a NAME="intro"></a>
<br>&nbsp;
<table BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH="100%" BGCOLOR="#C4ECFF" >
<tr>
<td ALIGN=LEFT WIDTH="1%"><spacer type=block width=1 height=1></td>

<td ALIGN=LEFT><b>Intro</b></td>

<td ALIGN=RIGHT VALIGN=BOTTOM><b><a href="index.html">home</a> - <a href="#top">top
of the page</a> - </b></td>

<td ALIGN=LEFT WIDTH="1%"><spacer type=block width=1 height=1></td>
</tr>
</table>

<p><br>
The titles below are the basics you should know about Oracle Utilities. Don&rsquo;t read the article in their entirety, just look through them to get the keywords and look at the examples.
<br>Regarding Perl and Oracle. From Perl I can call a Windows batch file which executes a stored procedure from SQL*Plus. After the procedure executes, I send an email through the MIME:Lite module.
<p><span class="style1">SQL*Loader </span>- To load data into the database:</p>
<ul>
  <li><a href="http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch03.htm#1004621">http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch03.htm#1004621</a> - read 1-paragraph</li>
  <li>Here is how to make a Control File: <a href="http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch05.htm#1004643">http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch05.htm#1004643</a> </li>
  <li> Conventional and Direct Path Loads: <a href="http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch09.htm#1007504">http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch09.htm#1007504</a> </li>
  <li>SQL*Loader Command-Line Reference(example): <a href="http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch04.htm#1656">http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch04.htm#1656</a> </li>
</ul>
<p class="style1">Export Utility</p>
<p>http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch01.htm#1004671 - Export Utility</p>
<p>http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch01.htm#1006108 - Export Sessions</p>
<p>-------------------------------------------- </p>
<p class="style1">Import Utility</p>
<p><a href="http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch02.htm#1004685">http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch02.htm#1004685</a> </p>
<p>Using Export and Import to Partition a Database Migration: <a href="http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch02.htm#1006883">http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96652/ch02.htm#1006883</a> </p>
<p>===========================================</p>
<p class="style1">Partitioning</p>
<p><a href="http://download-uk.oracle.com/docs/cd/B10501_01/server.920/a96524/c12parti.htm#429785">http://download-uk.oracle.com/docs/cd/B10501_01/server.920/a96524/c12parti.htm#429785</a> - Intro</p>
<p><a href="http://download-uk.oracle.com/docs/cd/B10501_01/server.920/a96520/parpart.htm#98124">http://download-uk.oracle.com/docs/cd/B10501_01/server.920/a96520/parpart.htm#98124</a> - types of partitionning</p>
<p class="style1">Range Partitioning Example</p>
<p>CREATE TABLE sales_range (salesman_id  NUMBER(5), salesman_name VARCHAR2(30), sales_amount  NUMBER(10), sales_date    DATE)</p>
<p>PARTITION BY RANGE(sales_date) (<br>
  PARTITION sales_jan2000 VALUES LESS THAN(TO_DATE('02/01/2000','DD/MM/YYYY')),<br>
  PARTITION sales_feb2000 VALUES LESS THAN(TO_DATE('03/01/2000','DD/MM/YYYY')),<br>
  PARTITION sales_mar2000 VALUES LESS THAN(TO_DATE('04/01/2000','DD/MM/YYYY')),<br>
  PARTITION sales_apr2000 VALUES LESS THAN(TO_DATE('05/01/2000','DD/MM/YYYY'))<br>
);</p>
<p class="style1">Partitions</p>
<p>1. You can't alter existing table to add partitions. The one possibility is to create a new one with partitions and later on transfer data from old to new one. Partitions could be 2 kinds - range and hash .You can choose one of them or composition as well. Range key splits data into partitions by value (often by date ), Hash distributes data in almost even containers. It makes sense to have separate tablespace for each partition.<br>
</p>
<p>Because partition could be logically treated as separate table, all queries will be speed up, because of pruning unnecessary partitions. </p>
<p>For instance, composite partitioned table: </p>
<p>CREATE TABLE PAYMENT ( Payment_Id NUMBER(10) NOT NULL, Execution_Date date NULL, State VARCHAR2(20) NULL, ) <br>
PARTITION BY RANGE(execution_date) <br>
SUBPARTITION BY HASH(payment_id) SUBPARTITIONS 4 <br>
STORE IN (USERS1,USERS2,USERS3,USERS4) </p>
<p>( PARTITION r1 VALUES LESS THAN (TO_DATE('2001/06/20', 'YYYY/MM/DD')) <br>
( SUBPARTITION r1_h1 TABLESPACE USERS1, SUBPARTITION r1_h2 TABLESPACE USERS2), </p>
<p>PARTITION r2 VALUES LESS THAN (TO_DATE('2001/06/21', 'YYYY/MM/DD')) <br>
( SUBPARTITION r2_h3 TABLESPACE USERS3, SUBPARTITION r2_h4 TABLESPACE USERS4) ) </p>
<p>2. If you will make a partitioned table, oracle handles internal which record to which partition should go - you don't need to care about it, so simply take the usual file to SQL loader. Later on , you can test, how the data were distributed into partitions with SELECT * FROM payments SUBPARTITION (r2_h4 ). </p>
<p><a NAME="more_on_bulk_operations"></a> <br>
&nbsp;</p>
<table BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH="100%" BGCOLOR="#C4ECFF" >
  <tr>
    <td ALIGN=LEFT WIDTH="1%"><spacer type=block width=1 height=1></td>
    <td ALIGN=LEFT><b>More on Blk Operations in Oracle</b></td>
    <td ALIGN=RIGHT VALIGN=BOTTOM><b><a href="index.html">home</a> - <a href="#top">top
      of the page</a> - </b></td>
    <td ALIGN=LEFT WIDTH="1%"><spacer type=block width=1 height=1></td>
  </tr>
</table>
<p>

<p>Examples and discussions on how to do bulk operations in Oracle can be found here:

<p>&nbsp;&nbsp;&nbsp;http://asktom.oracle.com/pls/asktom/f?p=100:1:564207913312600::NO:RP::
<p>1) Unloading - http://asktom.oracle.com/tkyte/flat/index.html</p>
<p>1.1) Fastest - Tom Kyte's Pro*C utility (VP Oracle) array_flat.<br>
  minuses: requires C compiler and Pro*C libraries installed for<br>
  compilation (Windows/Unix)</p>
<p>$./array_flat userid=scott/tiger 'sqlstmt=select * from emp'  arraysize=100<br>
</p>
<p>(thats on 1 line) it will produce:</p>
<p>Connected to ORACLE as user: scott/tiger</p>
<p>Unloading 'select * from emp'<br>
  Array size = 100<br>
  EMPNO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO<br>
  7369,SMITH,CLERK,7902,17-DEC-1980 00:00:00,800,(null),20<br>
  7499,ALLEN,SALESMAN,7698,20-FEB-1981 00:00:00,1600,300,30<br>
  7521,WARD,SALESMAN,7698,22-FEB-1981 00:00:00,1250,500,30<br>
  7566,JONES,MANAGER,7839,02-APR-1981 00:00:00,2975,(null),20<br>
  7654,MARTIN,SALESMAN,7698,28-SEP-1981 00:00:00,1250,1400,30<br>
  7698,BLAKE,MANAGER,7839,01-MAY-1981 00:00:00,2850,(null),30<br>
  7782,CLARK,MANAGER,7839,09-JUN-1981 00:00:00,2450,(null),10<br>
  7788,SCOTT,ANALYST,7566,09-DEC-1982 00:00:00,3000,(null),20<br>
  7839,KING,PRESIDENT,(null),17-NOV-1981 00:00:00,5000,(null),10<br>
  7844,TURNER,SALESMAN,7698,08-SEP-1981 00:00:00,1500,0,30<br>
  7876,ADAMS,CLERK,7788,12-JAN-1983 00:00:00,1100,(null),20<br>
  7900,JAMES,CLERK,7698,03-DEC-1981 00:00:00,950,(null),30<br>
  7902,FORD,ANALYST,7566,03-DEC-1981 00:00:00,3000,(null),20<br>
  7934,MILLER,CLERK,7782,23-JAN-1982 00:00:00,1300,(null),10<br>
  14 rows extracted</p>
<p>Details - http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:459020243348</p>
<p>1.2) PL/SQL utl_file package can write file to directory on Oracle<br>
  server (or it should be mapped/mounted on Oracle server)</p>
<p>http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:235814350980</p>
<p>Average speed, requires directory to be precreated with proper rights<br>
  for oracle user and also directory should be also &quot;registered&quot; with<br>
  Oracle database by DBAs.<br>
  http://download-uk.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_5007.htm</p>
<p>================================================================<br>
  1.0) Super-puper unloading in Oracle 10g - unloading into external tables<br>
  -<br>
http://64.233.169.104/search?q=cache:aYvI4TgAulIJ:www.quest-pipelines.com/newsletter-v6/0705_D.htm+sqlplus+unloader&amp;hl=en&amp;ct=clnk&amp;cd=2&amp;gl=us</p>
<p>minus - can't write files to clien't directory, have to be written to 
  the directory accessible by Oracle server. Need to have &quot;Create 
  directory&quot; executed by DBAs<br>
Pluses: can have parallel unloading, but instead of one you will get 
  segmented self-contained files:<br>
  http://64.233.169.104/search?q=cache:aYvI4TgAulIJ:www.quest-pipelines.com/newsletter-v6/0705_D.htm+sqlplus+unloader+PARALLELISM+FOR+PERFORMANCE&amp;hl=en&amp;ct=clnk&amp;cd=1&amp;gl=us<br>
</p>
<p>1.3) sqlplus script (all version of Oracle)<br>
  Not as fast as other ways, but still fast, script is readable and easy 
  to modify, could be executed on any client computer.</p>
<p>http://asktom.oracle.com/tkyte/flat/unloader.zip</p>
<p>Usage:<br>
  $ sqlldr_exp scott/tiger dept<br>
  ^^^^^^^^^^^^^^  user/password table_name<br>
  script looks like this:</p>
<p>--sqlldr_exp1.sql<br>
  --settings (e.g. set echo off verify off etc.)<br>
  set linesize 9999<br>
  -- ^^^^^ potential max size of the row.</p>
<p>-- double quoted CSV<br>
  spool c:\temp\dataCSV.txt<br>
  -- spool /home/user/data.txt<br>
  select '&quot;'column1||'&quot;,&quot;'||column2||'&quot;' from table where ...<br>
  /<br>
  spool off<br>
  -- ^^^^^ turns off spooling into file, starts spooling to the screen</p>
<p>-- fixed length format<br>
  spool c:\temp\dataFIXED.txt<br>
  set linesize 128<br>
  select rpad(text_column1,100)||'<br>
  '||lpad(text2,50)||rpad(to_char(number_field),10)||to_char(sysdate,'YYYYMMDDHH24MISS')<br>
  from table<br>
  where ...<br>
  /<br>
  spool off</p>
<p>You can run it from sqlplus (have to login to Oracle first) 
  or from command line:<br>
sqlplus user/password -s @sqlldr_exp1.sql</p>
<p>-s (run script)</p>
<p>1.0.1) DBAs utilities:<br>
  Oracle datapump (expdp/impdp). In Oracle 10g replaces &quot;old&quot; utilities exp/imp 
  Raw tables and/or schema and/or user export / import:</p>
<p>http://64.233.169.104/search?q=cache:UWYkRB_78I0J:www.orafaq.com/wiki/Oracle_Datapump+wiki+ORACLE_DATAPUMP&amp;hl=en&amp;ct=clnk&amp;cd=1&amp;gl=us</p>
<p>2) Loading for new tables<br>
  2.1) Fastest way - external tables (work for Oracle 9i and above<br>
  You create special table (called external that has path and 
  instructions how to parse flat_file.</p>
<p>SQL&gt; connect user_bulkload<br>
  Enter password:<br>
  Connected.<br>
  SQL&gt; create table xtern_empl_rpt<br>
  2      ( empl_id varchar2(3),<br>
  3        last_name varchar2(50),<br>
  4        first_name varchar2(50),<br>
  5        ssn varchar2(9),<br>
  6       email_addr varchar2(100),<br>
  7        years_of_service number(2,0)<br>
  8      )<br>
  9      organization external<br>
  10      ( default directory xtern_data_dir<br>
  11        access parameters<br>
  12        ( records delimited by newline<br>
  13          fields terminated by ','<br>
  14        )<br>
  15        location ('employee_report.csv')<br>
  16    );</p>
<p>Table created.</p>
<p>Then you just select from this table as it is usual table.<br>
  http://www.orafaq.com/node/848</p>
<p>2.2) Loading for existing tables.<br>
  sqlloader (sqlldr) - has two modes direct=TRUE (triggers get disabled) 
  and conventional (regular inserts)</p>
<p>You have to create *.ctl file to describe file format, where to load etc.</p>
<p>Example 9-1 Setting the Date Format in the SQL*Loader Control File<br>
  LOAD DATA<br>
  INFILE 'data.dat'<br>
  INSERT INTO TABLE emp<br>
  FIELDS TERMINATED BY &quot;|&quot;<br>
  (<br>
  EMPNO NUMBER(4) NOT NULL,<br>
  ENAME CHAR(10),<br>
  JOB CHAR(9),<br>
  MGR NUMBER(4),<br>
  HIREDATE DATE 'YYYYMMDD',<br>
  SAL NUMBER(7,2),<br>
  COMM NUMBER(7,2),<br>
  DEPTNO NUMBER(2)<br>
  )</p>
<p>Control file might be created during data unload using your script.<br>
  http://64.233.169.104/search?q=cache:YmtuCJqSRhMJ:www.oracleutilities.com/OSUtil/sqlldr.html+sqlldr+direct%3DTRUE+position&amp;hl=en&amp;ct=clnk&amp;cd=4&amp;gl=us</p>
<p>Format can be also fixed, then loading is faster.<br>
  E.g.<br>
  LOAD DATA<br>
INFILE 'table_with_one_million_rows.dat'<br>
INTO TABLE TABLE_WITH_ONE_MILLION_ROWS<br>
( COL1  POSITION(1:4)     INTEGER EXTERNAL<br>
, COL2  POSITION(6:9)     INTEGER EXTERNAL<br>
, COL3  POSITION(11:46)   CHAR<br>
, col4  position(48:83)   CHAR<br>
, col5  position(85:120)  CHAR<br>
, COL6  POSITION(122:130) DATE &quot;MMDDYYYY&quot;<br>
)</p>
<p>http://64.233.169.104/search?q=cache:od_STSP412EJ:download-uk.oracle.com/docs/cd/B10501_01/server.920/a96652/ch09.htm+sqlldr+direct%3DTRUE+triggers&amp;hl=en&amp;ct=clnk&amp;cd=3&amp;gl=us</p>
<p><br>
xxxxxxxxxxxxxxxxxxxxxxxxxx</p>
<p>Subject: Loading data into partially loaded table.</p>
<p>3) Merge</p>
<p>3.1) Oracle 9i and above. Merging regular table with external (it<br>
  doen't matter that &quot;external&quot;, just because first you create external<br>
  table from flat file)</p>
<p>http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:1615330671789</p>
<p>Let's have table e1= table e2<br>
  Let's assume we accidentally deleted from table e1 some rows. Here is<br>
  how to recover.</p>
<p>merge into EMP e1<br>
  using EXTERNAL_TABLE e2<br>
  on ( e2.empno = e1.empno )<br>
  when matched then<br>
  update set e1.sal = e2.sal<br>
  when not matched then<br>
  insert ( empno, ename, job, mgr, hiredate, sal, comm, deptno )<br>
  values ( e2.empno, e2.ename, e2.job, e2.mgr, e2.hiredate, e2.sal,<br>
  e2.comm, e2.deptno<br>
  )<br>
  /<br>
  commit;</p>
<p>http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:1615330671789</p>
<p>1.5) Loading (fifth way)<br>
  Inserting million rows is faster with /*+ append*/ hint:<br>
  insert /*+ append */ into emp select * from external_table;</p>
<p>3.2) Sqlldr can reject dublicate row and create *.bad file for records 
  not loaded.<br>
  Also it can merge (as above) or load data from one file into 3 
  different tables (each row can be split into 3 tables, or diferent 
  rows can go to differnt tables)</p>
<p>4) Loading-unloading from database1 to database2. 
  You can create link in database1 to the database2 (it's like client 
  connection to database2. usual user/password is used. you have to 
  setup grants/privelegs)</p>
<p>then if you are connected to db1 you can say: select * from 
  table@dblink2 (&lt;-name of the link). or insert into table@dblink2 
  select * from table_db1.<br>
  Fast, but not fastest. Requires DBAs setup. <br>
  ==========================================================<br>
  Latest in Oracle 11g - Oracle Warehouse Builder (OWB)</p>
<p>http://www.oracle.com/technology/products/warehouse/index.html</p>
<p>I don't know anyone who used it yet.</p>
<p>1.6) Create materialized view in database2. Must have dblink to database1. 
  Then you can schedule a oracle job how often do you want to syncronize 
  table between databases.</p>
<p>2) If the table you are loading have a lot of records, sometimes 
  update will not be as productive as unloading/deleting data and 
  loading it again from file.</p>
<p>3) Partition Exchange<br>
  http://64.233.169.104/search?q=cache:XRVqIWSpc7AJ:www.dbazine.com/oracle/or-articles/jlewis17+alter+table+%22exchange+partition%22&amp;hl=en&amp;ct=clnk&amp;cd=3&amp;gl=us</p>
<p>You can load data into another table and then exchange partition (you 
  have to have both tables partitioned, and Oracle Server should have 
  partition feature (option))<br>
  What is Partition Exchange?One of the great features about 
  partitioning, and most specifically range-based partitioning, is the 
  ability to load in new data quickly and easily with minimal impact on the current users. The manuals indicate that the critical command to 
  achieve this is as follows:</p>
<p>  alter table pt_tab1 exchange partition p_9999 with table new_data--<br>
  including indexes -- optional-- without validation -- optional;<br>
  </p>
<p>This command &quot;hacks&quot; into the data dictionary and swaps over the 
  definitions of the named partition and the new_data table, so that the 
  data suddenly exists in the right place in the partitioned table. 
  Moreover, with the inclusion of the two optional extra clauses, index 
  definitions will be swapped and Oracle will not check whether the data 
  actually belongs in the partition so the exchange is very quick. 
  Or so the story goes.</p>
<p>  Typically an article to demonstrate this point about partition 
  exchange will create a table with a handful of partitions and a couple 
  of hundred rows per partition, quite possibly without indexes, and 
  almost certainly without any related tables. 
  Typically, if you've paid for the partitioning option, you will have 
  very large tables, a few indexes, and things like related tables with 
  foreign keys defined. So what happens in real life when you do a 
  partition exchange? <br>
  =============================================</p>
<p></p>
</body>
</html>
